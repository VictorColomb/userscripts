// ==UserScript==
// @name Tarmac Technologies
// @description Miscellaneous Tarmac Technologies Utilities
// @version 2.1.1
// @author Victor Colomb
// @match https://backoffice.tarmactechnologies.com/*
// @match https://dev-backoffice.tarmactechnologies.com/*
// @match https://admin.tarmactechnologies.com/*
// @match https://dev-admin.tarmactechnologies.com/*
// @match https://agoa.tarmactechnologies.com/*
// @match https://dev-agoa.tarmactechnologies.com/*
// @downloadURL https://github.com/VictorColomb/userscripts/raw/main/dist/tarmac-technologies.user.js
// @icon https://static-tarmac.s3.amazonaws.com/img/favicon.ico
// @updateURL https://github.com/VictorColomb/userscripts/raw/main/dist/tarmac-technologies.meta.js
// ==/UserScript==

(()=>{var e={109:e=>{e.exports=function(){const e=document.querySelector('label[for="id_business_groups"]'),t=document.querySelector('select[name="business_groups"]');e.addEventListener("click",(()=>{const e=[],o=[],n=[],r=[],s=[];for(const i of t.options){if(!i.selected)continue;const[t,a]=i.label.split(" ");switch(t){case"AIRLINE":e.push(a);break;case"AIRPORT":o.push(a);break;case"HANDLER":n.push(a);break;case"POSITION":r.push(a);break;default:console.warn(`Unknown business group type ${t} (name = ${a})`),s.push(i.label)}}const i=window.open("","","width=800, height=400, scrollbars=yes");i.document.body.innerHTML=`<label for="airlines" style="display: block;">Airlines</label><input type="text" name="airlines" id="airlines" value="${e.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,i.document.body.innerHTML+=`<label for="airports" style="display: block;">Airports</label><input type="text" name="airports" id="airports" value="${o.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,i.document.body.innerHTML+=`<label for="handlers" style="display: block;">Handlers</label><input type="text" name="handlers" id="handlers" value="${n.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,i.document.body.innerHTML+=`<label for="positions" style="display: block;">Positions</label><input type="text" name="positions" id="positions" value="${r.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,i.document.body.innerHTML+='<button id="submit">Submit</button>',i.document.querySelector("#submit").addEventListener("click",(()=>{!function(e,o,n,r,s){for(const e of t.options)e.selected=!1;for(const o of e){if(!o)continue;const e=Array.from(t.options).find((e=>e.label===`AIRLINE ${o.toUpperCase()}`));void 0===e?console.warn(`[TT Userscript] Cound not find airline ${o}`):e.selected=!0}for(const e of o){if(!e)continue;const o=Array.from(t.options).find((t=>t.label===`AIRPORT ${e.toUpperCase()}`));void 0===o?console.warn(`[TT Userscript] Cound not find airport ${e}`):o.selected=!0}for(const e of n){if(!e)continue;const o=Array.from(t.options).find((t=>t.label===`HANDLER ${e.toUpperCase()}`));void 0===o?console.warn(`[TT Userscript] Cound not find handler ${e}`):o.selected=!0}for(const e of r){if(!e)continue;const o=Array.from(t.options).find((t=>t.label===`POSITION ${e.toUpperCase()}`));void 0===o?console.warn(`[TT Userscript] Cound not find position ${e}`):o.selected=!0}for(const e of s){const o=Array.from(t.options).find((t=>t.label===e));void 0===o?console.error(`[TT Userscript] Could not find business group ${e}`):o.selected=!0}}(i.document.querySelector("#airlines").value.split(/[ ,]+/),i.document.querySelector("#airports").value.split(/[ ,]+/),i.document.querySelector("#handlers").value.split(/[ ,]+/),i.document.querySelector("#positions").value.split(/[ ,]+/),s),i.close()}))})),e.style="cursor: pointer; user-select: none;",console.log("[TT Userscript] Users module loaded")}},581:e=>{e.exports=function(e="admin"){setInterval((function(){Array.from(document.querySelectorAll('[id^="turnaroundDetailHeaderHubAirportIataCode"]')).forEach((t=>{if(!t.dataset.processed){const o=t.id.match(/turnaroundDetailHeaderHubAirportIataCode([0-9]+)/)[1];t.addEventListener("click",(()=>{window.open(`https://${e}.tarmactechnologies.com/tarmac/turnaround/${o}`)})),t.style="cursor: pointer; user-select: none;",t.dataset.processed=!0}}))}),1e3),console.log("[TT Userscript] Module loaded")}},614:e=>{e.exports=function(){function e(e,t){const o=document.evaluate('.//label[contains(., "Task Additional Information")]',t,null,XPathResult.ANY_TYPE,null).iterateNext();o?(o.addEventListener("click",(()=>{const o=window.open("","","width=800, height=400, scrollbars=yes");o.document.body.innerHTML='<textarea name="addinfos" id="addinfos" rows="10" style="display: block; height: calc(100% - 20px); width: 100%; padding: 5px;"></textarea><button id="submit">Submit</button>';let n="";for(const o of t.querySelectorAll(".task-additional-information-tbody tr")){const t=o.querySelector(`select[name="normal-${e}-task-additional-information-label-id"]`).selectedOptions,r=t.length>0?t[0].label:"",s=o.querySelector(`input[name="normal-${e}-task-additional-information-custom-label"]`).value,i=o.querySelector(`select[name="normal-${e}-task-additional-information-type"]`).selectedOptions;n+=`${r},${s},${i.length>0?i[0].label:""},${o.querySelector('input[type="checkbox"]').checked?"true":"false"}\n`}",,Checkbox,false\n"===n&&(n="");const r=o.document.getElementById("addinfos");r.value=n,o.document.getElementById("submit").addEventListener("click",(()=>{(function(o,n){const r=n.split("\n").map((e=>e.split(",")[0]));if(r.some(((e,t)=>r.indexOf(e)<t)))return o.alert("Duplicate hard labels not allowed!"),!1;for(const e of t.querySelectorAll(".task-additional-information-tbody button.delete-task-additional-information"))e.click();for(const[r,s]of n.split("\n").entries()){if(""===s.trim())continue;const n=s.split(",");if(n.length<3)return o.alert("Three or four columns required!"),!1;r>0&&t.querySelector(".add-task-additional-information").click();const[i,a,l]=n,c=Array.from(t.querySelectorAll(".task-additional-information-tbody tr")).at(-1),d=c.querySelector(`select[name="normal-${e}-task-additional-information-label-id"]`),u=Array.from(d.options).find((e=>e.label.toLowerCase()===i.toLowerCase()));void 0===u?console.warn(`[TT Userscript] Could not find label ${i}`):u.selected=!0,c.querySelector(`input[name="normal-${e}-task-additional-information-custom-label"]`).value=a;const p=c.querySelector(`select[name="normal-${e}-task-additional-information-type"]`),m=Array.from(p.options).find((e=>e.label.toLowerCase()===l.toLowerCase()));if(void 0===m?console.warn(`[TT Userscript] Could not find type ${l}`):m.selected=!0,n.length>3){const e="true"===n[3].toLowerCase();c.querySelector('input[type="checkbox"]').checked=e}}return!0})(o,r.value)&&o.close()}))})),o.style="cursor: pointer; user-select: none;"):console.error("[TT Userscript] Add info label not found")}for(const t of["above","below"])for(const o of document.querySelectorAll(`#normal-${t}-table-body tr.row-id`))e(t,o);document.querySelector('button[data-action="add"][data-target="#normal-above-table"]').addEventListener("click",(t=>{t.stopPropagation(),addRow("#normal-above-table"),e("above",Array.from(document.querySelectorAll("#normal-above-table-body tr.row-id")).at(-1))})),document.querySelector('button[data-action="add"][data-target="#normal-below-table"]').addEventListener("click",(t=>{t.stopPropagation(),addRow("#normal-below-table"),e("below",Array.from(document.querySelectorAll("#normal-below-table-body tr.row-id")).at(-1))})),console.log("[TT Userscript] Critical path module loaded")}},986:e=>{e.exports=function(){const e=document.evaluate('//h3[contains(., "Task timings")]',document,null,XPathResult.ANY_TYPE,null).iterateNext();e?(e.addEventListener("click",(()=>{const e=document.evaluate('//section[contains(., "Task timings")]',document,null,XPathResult.ANY_TYPE,null).iterateNext();if(e)for(const t of e.querySelectorAll("input[type=checkbox]"))t.checked||t.parentNode.click();else console.error("[TT Userscript] Task Timings section not found")})),e.style="cursor: pointer; user-select: none;",console.log("[TT Userscript] Report module loaded")):console.error("[TT Userscript] Task Timings section not found")}},293:e=>{e.exports=function(e="admin"){new MutationObserver((t=>{for(const o of t)if("childList"===o.type)for(const t of o.addedNodes){const o=t.querySelector("a").href.match(/\/([0-9]+)\//)[1],n=t.children[1];n.addEventListener("click",(()=>{window.open(`https://${e}.tarmactechnologies.com/users/customuser/${o}`)})),n.style="cursor: pointer; user-select: none;"}})).observe(document.querySelector("#users-list tbody"),{childList:!0,subtree:!0}),console.log("[TT Userscript] Users module loaded")}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}(()=>{const e=o(109),t=o(581),n=o(986),r=o(614),s=o(293);!function(){"use strict";const o=window.location.hostname,i=window.location.pathname;/^(?:dev-)?backoffice.tarmactechnologies.com$/.test(o)&&((/^\/turnaround_close_report\/new/.test(i)||/^\/turnaround_close_report\/[0-9]+\/edit/.test(i))&&n(),/^\/(?:specific_)?critical_path\/(?:[0-9]+\/)?(?:edit|add|new)/.test(i)&&r(),/\/users/i.test(i)&&s(/^dev-backoffice/.test(o)?"dev-admin":"admin")),/^(?:dev-)?admin.tarmactechnologies.com$/.test(o)&&/^\/users\/customuser\/[0-9]+\/change/.test(i)&&e(),/(?:dev-)?agoa.tarmactechnologies.com/.test(o)&&/^\/(?:agoa)?$/.test(i)&&t()}()})()})();
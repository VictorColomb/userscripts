// ==UserScript==
// @name Tarmac Technologies
// @description Miscellaneous Tarmac Technologies Utilities
// @version 2.4.1
// @author Victor Colomb
// @match https://backoffice.tarmactechnologies.com/*
// @match https://dev-backoffice.tarmactechnologies.com/*
// @match https://admin.tarmactechnologies.com/*
// @match https://dev-admin.tarmactechnologies.com/*
// @match https://agoa.tarmactechnologies.com/*
// @match https://dev-agoa.tarmactechnologies.com/*
// @downloadURL https://github.com/VictorColomb/userscripts/raw/main/dist/tarmac-technologies.user.js
// @icon https://static-tarmac.s3.amazonaws.com/img/favicon.ico
// @updateURL https://github.com/VictorColomb/userscripts/raw/main/dist/tarmac-technologies.meta.js
// ==/UserScript==

(()=>{var e={449:e=>{e.exports=function(){!function(){const e=document.querySelector('label[for="id_business_groups"]'),t=document.querySelector('select[name="business_groups"]'),o=document.querySelector('input[name="name"]').value,n=[[e,t,()=>o]];for(const s of document.querySelectorAll('select[name$="-business_groups"]')){s.insertAdjacentHTML("afterend",`<span class="related-widget-wrapper-link add-related" id="popup-${s.id}" title="Add another Company Business Group"><img src="https://static-tarmac.s3.amazonaws.com/admin/img/icon-yes.svg" alt="Popup"></span>`);const i=document.getElementById(`popup-${s.id}`);n.push([i,s,()=>document.querySelector(`select[name="${s.name.match(/^(.*)-business_groups$/)[1]}-related_company"]`).selectedOptions[0].innerHTML+" (related)"])}for(const[l,a,c]of n){function r(e){for(const e of a.options)e.selected=!1;for(let t of e){if(t=t.trim().toUpperCase().match(/([A-Z0-9]{2}).*([A-Z]{3})/),!t)continue;t=`${t[1]} - ${t[2]}`;const e=Array.from(a.options).find((e=>e.label===t));void 0===e?console.warn(`[TT Userscript] Cound not find company business group ${t}`):e.selected=!0}}l.addEventListener("click",(()=>{const e=Array.from(a.options).filter((e=>e.selected)).map((e=>e.label)),t=window.open("","","width=800, height=400");t.document.title=`${c()} | Company Business Groups`,t.document.body.innerHTML=`<label for="cbg" style="display: block;">Company Business Groups</label><textarea type="text" name="cbg" id="cbg" style="width: 100%; height: calc(100% - 60px); margin-bottom: 15px;">${e.join("\n")}</textarea><br><button id="submit">Submit</button>`,t.document.querySelector("#submit").addEventListener("click",(()=>{r(t.document.querySelector("#cbg").value.split("\n")),t.close()})),window.addEventListener("beforeunload",(()=>{t.close()})),t.document.addEventListener("keydown",(e=>{e.ctrlKey&&"Enter"===e.key&&t.document.querySelector("#submit").click(),"Escape"===e.key&&t.close()}))})),l.style="cursor: pointer; user-select: none;"}}(),console.log("[TT Userscript] Companies module loaded")}},206:e=>{e.exports=function(){(function(){const e=document.querySelector('label[for="id_airlines"]'),t=document.querySelector('select[name="airlines"]'),o=document.querySelector('input[name="information_code"]').value;e.addEventListener("click",(()=>{const e=Array.from(t.options).filter((e=>e.selected)).map((e=>e.label.substring(1,3))),n=window.open("","","width=400, height=400");n.document.title=`${o} | Airlines`,n.document.body.innerHTML=`<label for="cbg" style="display: block;">Airlines</label><textarea type="text" name="airlines" id="airlines" style="width: 100%; height: calc(100% - 60px); margin-bottom: 15px;">${e.join("\n")}</textarea><br><button id="submit">Submit</button>`,n.document.querySelector("#submit").addEventListener("click",(()=>{!function(e){for(const e of t.options)e.selected=!1;for(let o of e){if(o=o.trim().toUpperCase(),!o)continue;const e=Array.from(t.options).find((e=>e.label.substring(1,3)===o));void 0===e?console.warn(`[TT Userscript] Cound not find airline ${o}`):e.selected=!0}}(n.document.querySelector("#airlines").value.split("\n")),n.close()})),window.addEventListener("beforeunload",(()=>{n.close()})),n.document.addEventListener("keydown",(e=>{e.ctrlKey&&"Enter"===e.key&&n.document.querySelector("#submit").click(),"Escape"===e.key&&n.close()}))})),e.style="cursor: pointer; user-select: none;"})(),function(){const e=document.querySelector('label[for="id_airports"]'),t=document.querySelector('select[name="airports"]'),o=document.querySelector('input[name="information_code"]').value;e.addEventListener("click",(()=>{const e=Array.from(t.options).filter((e=>e.selected)).map((e=>e.label.substring(0,3))),n=window.open("","","width=400, height=400");n.document.title=`${o} | Airlines`,n.document.body.innerHTML=`<label for="cbg" style="display: block;">Airports</label><textarea type="text" name="airports" id="airports" style="width: 100%; height: calc(100% - 60px); margin-bottom: 15px;">${e.join("\n")}</textarea><br><button id="submit">Submit</button>`,n.document.querySelector("#submit").addEventListener("click",(()=>{!function(e){for(const e of t.options)e.selected=!1;for(let o of e){if(o=o.trim().toUpperCase(),!o)continue;const e=Array.from(t.options).find((e=>e.label.substring(0,3)===o));void 0===e?console.warn(`[TT Userscript] Cound not find airport ${o}`):e.selected=!0}}(n.document.querySelector("#airports").value.split("\n")),n.close()})),window.addEventListener("beforeunload",(()=>{n.close()})),n.document.addEventListener("keydown",(e=>{e.ctrlKey&&"Enter"===e.key&&n.document.querySelector("#submit").click(),"Escape"===e.key&&n.close()}))})),e.style="cursor: pointer; user-select: none;"}(),console.log("[TT Userscript] Partner Task Rules module loaded")}},109:e=>{e.exports=function(){(function(){const e=document.querySelector('label[for="id_business_groups"]'),t=document.querySelector('select[name="business_groups"]'),o=document.querySelector('input[name="username"]').value;e.addEventListener("click",(()=>{const e=[],n=[],r=[],s=[],i=[];for(const o of t.options){if(!o.selected)continue;const[t,l]=o.label.split(" ");switch(t){case"AIRLINE":e.push(l);break;case"AIRPORT":n.push(l);break;case"HANDLER":r.push(l);break;case"POSITION":s.push(l);break;default:console.warn(`Unknown business group type ${t} (name = ${l})`),i.push(o.label)}}const l=window.open("","","width=800, height=400, scrollbars=yes");l.document.title=`${o} | Business Groups`,l.document.body.innerHTML=`<label for="airlines" style="display: block;">Airlines</label><input type="text" name="airlines" id="airlines" value="${e.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,l.document.body.innerHTML+=`<label for="airports" style="display: block;">Airports</label><input type="text" name="airports" id="airports" value="${n.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,l.document.body.innerHTML+=`<label for="handlers" style="display: block;">Handlers</label><input type="text" name="handlers" id="handlers" value="${r.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,l.document.body.innerHTML+=`<label for="positions" style="display: block;">Positions</label><input type="text" name="positions" id="positions" value="${s.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,l.document.body.innerHTML+='<button id="submit">Submit</button>',l.document.querySelector("#submit").addEventListener("click",(()=>{!function(e,o,n,r,s){for(const e of t.options)e.selected=!1;for(const o of e){if(!o)continue;const e=Array.from(t.options).find((e=>e.label===`AIRLINE ${o.toUpperCase()}`));void 0===e?console.warn(`[TT Userscript] Cound not find airline ${o}`):e.selected=!0}for(const e of o){if(!e)continue;const o=Array.from(t.options).find((t=>t.label===`AIRPORT ${e.toUpperCase()}`));void 0===o?console.warn(`[TT Userscript] Cound not find airport ${e}`):o.selected=!0}for(const e of n){if(!e)continue;const o=Array.from(t.options).find((t=>t.label===`HANDLER ${e.toUpperCase()}`));void 0===o?console.warn(`[TT Userscript] Cound not find handler ${e}`):o.selected=!0}for(const e of r){if(!e)continue;const o=Array.from(t.options).find((t=>t.label===`POSITION ${e.toUpperCase()}`));void 0===o?console.warn(`[TT Userscript] Cound not find position ${e}`):o.selected=!0}for(const e of s){const o=Array.from(t.options).find((t=>t.label===e));void 0===o?console.error(`[TT Userscript] Could not find business group ${e}`):o.selected=!0}}(l.document.querySelector("#airlines").value.split(/[ ,]+/),l.document.querySelector("#airports").value.split(/[ ,]+/),l.document.querySelector("#handlers").value.split(/[ ,]+/),l.document.querySelector("#positions").value.split(/[ ,]+/),i),l.close()})),window.addEventListener("beforeunload",(()=>{l.close()})),l.document.addEventListener("keydown",(e=>{e.ctrlKey&&"Enter"===e.key&&l.document.querySelector("#submit").click(),"Escape"===e.key&&l.close()}))})),e.style="cursor: pointer; user-select: none;"})(),function(){const e=document.querySelector('label[for="id_company_business_groups"]'),t=document.querySelector('select[name="company_business_groups"]'),o=document.querySelector('input[name="username"]').value;e.addEventListener("click",(()=>{const e=Array.from(t.options).filter((e=>e.selected)).map((e=>e.label)),n=window.open("","","width=800, height=400");n.document.title=`${o} | Company Business Groups`,n.document.body.innerHTML=`<label for="cbg" style="display: block;">Company Business Groups</label><textarea type="text" name="cbg" id="cbg" style="width: 100%; height: calc(100% - 60px); margin-bottom: 15px;">${e.join("\n")}</textarea><br><button id="submit">Submit</button>`,n.document.querySelector("#submit").addEventListener("click",(()=>{!function(e){for(const e of t.options)e.selected=!1;for(let o of e){if(o=o.trim().toUpperCase().match(/([A-Z0-9]{2}).*([A-Z]{3})/),!o)continue;o=`${o[1]} - ${o[2]}`;const e=Array.from(t.options).find((e=>e.label===o));void 0===e?console.warn(`[TT Userscript] Cound not find company business group ${o}`):e.selected=!0}}(n.document.querySelector("#cbg").value.split("\n")),n.close()})),window.addEventListener("beforeunload",(()=>{n.close()})),n.document.addEventListener("keydown",(e=>{e.ctrlKey&&"Enter"===e.key&&n.document.querySelector("#submit").click(),"Escape"===e.key&&n.close()}))})),e.style="cursor: pointer; user-select: none;"}(),console.log("[TT Userscript] Users module loaded")}},581:e=>{e.exports=function(e="admin"){setInterval((function(){Array.from(document.querySelectorAll('[id^="turnaroundDetailHeaderTurnaroundActualAirport"]')).forEach((t=>{if(!t.dataset.processed){const o=t.id.match(/turnaroundDetailHeaderTurnaroundActualAirport([0-9]+)/)[1];t.addEventListener("click",(()=>{window.open(`https://${e}.tarmactechnologies.com/tarmac/turnaround/${o}`)})),t.style="cursor: pointer; user-select: none;",t.dataset.processed=!0}}))}),1e3),console.log("[TT Userscript] Module loaded")}},614:e=>{e.exports=function(){function e(e,t){const o=document.evaluate('.//label[contains(., "Task Additional Information")]',t,null,XPathResult.ANY_TYPE,null).iterateNext();o?(o.addEventListener("click",(()=>{const o=window.open("","","width=800, height=400, scrollbars=yes");o.document.body.innerHTML='<textarea name="addinfos" id="addinfos" rows="10" style="display: block; height: calc(100% - 20px); width: 100%; padding: 5px;"></textarea><button id="submit">Submit</button>';let n="";for(const o of t.querySelectorAll(".task-additional-information-tbody tr")){const t=o.querySelector(`select[name="normal-${e}-task-additional-information-label-id"]`).selectedOptions,r=t.length>0?t[0].label:"",s=o.querySelector(`input[name="normal-${e}-task-additional-information-custom-label"]`).value,i=o.querySelector(`select[name="normal-${e}-task-additional-information-type"]`).selectedOptions;n+=`${r},${s},${i.length>0?i[0].label:""},${o.querySelector('input[type="checkbox"]').checked?"true":"false"}\n`}",,Checkbox,false\n"===n&&(n="");const r=o.document.getElementById("addinfos");r.value=n,o.document.getElementById("submit").addEventListener("click",(()=>{(function(o,n){const r=n.split("\n").map((e=>e.split(",")[0]));if(r.some(((e,t)=>r.indexOf(e)<t)))return o.alert("Duplicate hard labels not allowed!"),!1;for(const e of t.querySelectorAll(".task-additional-information-tbody button.delete-task-additional-information"))e.click();for(const[r,s]of n.split("\n").entries()){if(""===s.trim())continue;const n=s.split(",");if(n.length<3)return o.alert("Three or four columns required!"),!1;r>0&&t.querySelector(".add-task-additional-information").click();const[i,l,a]=n,c=Array.from(t.querySelectorAll(".task-additional-information-tbody tr")).at(-1),d=c.querySelector(`select[name="normal-${e}-task-additional-information-label-id"]`),u=Array.from(d.options).find((e=>e.label.toLowerCase()===i.toLowerCase()));void 0===u?console.warn(`[TT Userscript] Could not find label ${i}`):u.selected=!0,c.querySelector(`input[name="normal-${e}-task-additional-information-custom-label"]`).value=l;const m=c.querySelector(`select[name="normal-${e}-task-additional-information-type"]`),p=Array.from(m.options).find((e=>e.label.toLowerCase()===a.toLowerCase()));if(void 0===p?console.warn(`[TT Userscript] Could not find type ${a}`):p.selected=!0,n.length>3){const e="true"===n[3].toLowerCase();c.querySelector('input[type="checkbox"]').checked=e}}return!0})(o,r.value)&&o.close()}))})),o.style="cursor: pointer; user-select: none;"):console.error("[TT Userscript] Add info label not found")}for(const t of["above","below"])for(const o of document.querySelectorAll(`#normal-${t}-table-body tr.row-id`))e(t,o);document.querySelector('button[data-action="add"][data-target="#normal-above-table"]').addEventListener("click",(t=>{t.stopPropagation(),addRow("#normal-above-table"),e("above",Array.from(document.querySelectorAll("#normal-above-table-body tr.row-id")).at(-1))})),document.querySelector('button[data-action="add"][data-target="#normal-below-table"]').addEventListener("click",(t=>{t.stopPropagation(),addRow("#normal-below-table"),e("below",Array.from(document.querySelectorAll("#normal-below-table-body tr.row-id")).at(-1))})),console.log("[TT Userscript] Critical path module loaded")}},293:e=>{e.exports=function(e="admin"){new MutationObserver((t=>{for(const o of t)if("childList"===o.type)for(const t of o.addedNodes){const o=t.querySelector("a").href.match(/\/([0-9]+)\//)[1],n=t.children[1];n.addEventListener("click",(()=>{window.open(`https://${e}.tarmactechnologies.com/users/customuser/${o}`)})),n.style="cursor: pointer; user-select: none;"}})).observe(document.querySelector("#users-list tbody"),{childList:!0,subtree:!0}),console.log("[TT Userscript] Users module loaded")}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}(()=>{const e=o(449),t=o(206),n=o(109),r=o(581),s=o(614),i=o(293);!function(){"use strict";const o=window.location.hostname,l=window.location.pathname;/^(?:dev-)?backoffice.tarmactechnologies.com$/.test(o)&&(/^\/(?:specific_)?critical_path\/(?:[0-9]+\/)?(?:edit|add|new)/.test(l)&&s(),/\/users/i.test(l)&&i(/^dev-backoffice/.test(o)?"dev-admin":"admin")),/^(?:dev-)?admin.tarmactechnologies.com$/.test(o)&&(/^\/users\/customuser\/[0-9]+\/change/.test(l)&&n(),/^\/tarmac\/company\/(?:[0-9]+\/change|add)/.test(l)&&e(),/^\/tarmac\/partnertaskrule\/[0-9]+\/change/.test(l)&&(console.log("hear hear"),t())),/(?:dev-)?agoa.tarmactechnologies.com/.test(o)&&/^\/(?:agoa)?$/.test(l)&&r(/^dev-agoa/.test(o)?"dev-admin":"admin")}()})()})();
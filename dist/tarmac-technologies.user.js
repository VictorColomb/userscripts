// ==UserScript==
// @name Tarmac Technologies
// @description Miscellaneous Tarmac Technologies Utilities
// @version 2.2.0
// @author Victor Colomb
// @match https://backoffice.tarmactechnologies.com/*
// @match https://dev-backoffice.tarmactechnologies.com/*
// @match https://admin.tarmactechnologies.com/*
// @match https://dev-admin.tarmactechnologies.com/*
// @match https://agoa.tarmactechnologies.com/*
// @match https://dev-agoa.tarmactechnologies.com/*
// @downloadURL https://github.com/VictorColomb/userscripts/raw/main/dist/tarmac-technologies.user.js
// @icon https://static-tarmac.s3.amazonaws.com/img/favicon.ico
// @updateURL https://github.com/VictorColomb/userscripts/raw/main/dist/tarmac-technologies.meta.js
// ==/UserScript==

(()=>{var e={109:e=>{e.exports=function(){(function(){const e=document.querySelector('label[for="id_business_groups"]'),o=document.querySelector('select[name="business_groups"]'),t=document.querySelector('input[name="username"]').value;e.addEventListener("click",(()=>{const e=[],n=[],r=[],s=[],i=[];for(const t of o.options){if(!t.selected)continue;const[o,a]=t.label.split(" ");switch(o){case"AIRLINE":e.push(a);break;case"AIRPORT":n.push(a);break;case"HANDLER":r.push(a);break;case"POSITION":s.push(a);break;default:console.warn(`Unknown business group type ${o} (name = ${a})`),i.push(t.label)}}const a=window.open("","","width=800, height=400, scrollbars=yes");a.document.title=`${t} | Business Groups`,a.document.body.innerHTML=`<label for="airlines" style="display: block;">Airlines</label><input type="text" name="airlines" id="airlines" value="${e.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,a.document.body.innerHTML+=`<label for="airports" style="display: block;">Airports</label><input type="text" name="airports" id="airports" value="${n.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,a.document.body.innerHTML+=`<label for="handlers" style="display: block;">Handlers</label><input type="text" name="handlers" id="handlers" value="${r.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,a.document.body.innerHTML+=`<label for="positions" style="display: block;">Positions</label><input type="text" name="positions" id="positions" value="${s.join(",")}" style="width: 100%; margin-bottom: 15px;" /><br>`,a.document.body.innerHTML+='<button id="submit">Submit</button>',a.document.querySelector("#submit").addEventListener("click",(()=>{!function(e,t,n,r,s){for(const e of o.options)e.selected=!1;for(const t of e){if(!t)continue;const e=Array.from(o.options).find((e=>e.label===`AIRLINE ${t.toUpperCase()}`));void 0===e?console.warn(`[TT Userscript] Cound not find airline ${t}`):e.selected=!0}for(const e of t){if(!e)continue;const t=Array.from(o.options).find((o=>o.label===`AIRPORT ${e.toUpperCase()}`));void 0===t?console.warn(`[TT Userscript] Cound not find airport ${e}`):t.selected=!0}for(const e of n){if(!e)continue;const t=Array.from(o.options).find((o=>o.label===`HANDLER ${e.toUpperCase()}`));void 0===t?console.warn(`[TT Userscript] Cound not find handler ${e}`):t.selected=!0}for(const e of r){if(!e)continue;const t=Array.from(o.options).find((o=>o.label===`POSITION ${e.toUpperCase()}`));void 0===t?console.warn(`[TT Userscript] Cound not find position ${e}`):t.selected=!0}for(const e of s){const t=Array.from(o.options).find((o=>o.label===e));void 0===t?console.error(`[TT Userscript] Could not find business group ${e}`):t.selected=!0}}(a.document.querySelector("#airlines").value.split(/[ ,]+/),a.document.querySelector("#airports").value.split(/[ ,]+/),a.document.querySelector("#handlers").value.split(/[ ,]+/),a.document.querySelector("#positions").value.split(/[ ,]+/),i),a.close()})),window.addEventListener("beforeunload",(()=>{a.close()}))})),e.style="cursor: pointer; user-select: none;",console.log("[TT Userscript] Users module loaded")})(),function(){const e=document.querySelector('label[for="id_company_business_groups"]'),o=document.querySelector('select[name="company_business_groups"]'),t=document.querySelector('input[name="username"]').value;e.addEventListener("click",(()=>{const e=Array.from(o.options).filter((e=>e.selected)).map((e=>e.label)),n=window.open("","","width=800, height=400");n.document.title=`${t} | Company Business Groups`,n.document.body.innerHTML=`<label for="cbg" style="display: block;">Company Business Groups</label><textarea type="text" name="cbg" id="cbg" style="width: 100%; height: calc(100% - 60px); margin-bottom: 15px;">${e.join("\n")}</textarea><br><button id="submit">Submit</button>`,n.document.querySelector("#submit").addEventListener("click",(()=>{!function(e){for(const e of o.options)e.selected=!1;for(let t of e){if(t=t.trim().toUpperCase().match(/([A-Z]{2}).*([A-Z]{3})/),!t)continue;t=`${t[1]} - ${t[2]}`;const e=Array.from(o.options).find((e=>e.label===t));void 0===e?console.warn(`[TT Userscript] Cound not find company business group ${t}`):e.selected=!0}}(n.document.querySelector("#cbg").value.split("\n")),n.close()})),window.addEventListener("beforeunload",(()=>{n.close()}))})),e.style="cursor: pointer; user-select: none;"}()}},581:e=>{e.exports=function(e="admin"){setInterval((function(){Array.from(document.querySelectorAll('[id^="turnaroundDetailHeaderHubAirportIataCode"]')).forEach((o=>{if(!o.dataset.processed){const t=o.id.match(/turnaroundDetailHeaderHubAirportIataCode([0-9]+)/)[1];o.addEventListener("click",(()=>{window.open(`https://${e}.tarmactechnologies.com/tarmac/turnaround/${t}`)})),o.style="cursor: pointer; user-select: none;",o.dataset.processed=!0}}))}),1e3),console.log("[TT Userscript] Module loaded")}},614:e=>{e.exports=function(){function e(e,o){const t=document.evaluate('.//label[contains(., "Task Additional Information")]',o,null,XPathResult.ANY_TYPE,null).iterateNext();t?(t.addEventListener("click",(()=>{const t=window.open("","","width=800, height=400, scrollbars=yes");t.document.body.innerHTML='<textarea name="addinfos" id="addinfos" rows="10" style="display: block; height: calc(100% - 20px); width: 100%; padding: 5px;"></textarea><button id="submit">Submit</button>';let n="";for(const t of o.querySelectorAll(".task-additional-information-tbody tr")){const o=t.querySelector(`select[name="normal-${e}-task-additional-information-label-id"]`).selectedOptions,r=o.length>0?o[0].label:"",s=t.querySelector(`input[name="normal-${e}-task-additional-information-custom-label"]`).value,i=t.querySelector(`select[name="normal-${e}-task-additional-information-type"]`).selectedOptions;n+=`${r},${s},${i.length>0?i[0].label:""},${t.querySelector('input[type="checkbox"]').checked?"true":"false"}\n`}",,Checkbox,false\n"===n&&(n="");const r=t.document.getElementById("addinfos");r.value=n,t.document.getElementById("submit").addEventListener("click",(()=>{(function(t,n){const r=n.split("\n").map((e=>e.split(",")[0]));if(r.some(((e,o)=>r.indexOf(e)<o)))return t.alert("Duplicate hard labels not allowed!"),!1;for(const e of o.querySelectorAll(".task-additional-information-tbody button.delete-task-additional-information"))e.click();for(const[r,s]of n.split("\n").entries()){if(""===s.trim())continue;const n=s.split(",");if(n.length<3)return t.alert("Three or four columns required!"),!1;r>0&&o.querySelector(".add-task-additional-information").click();const[i,a,l]=n,c=Array.from(o.querySelectorAll(".task-additional-information-tbody tr")).at(-1),d=c.querySelector(`select[name="normal-${e}-task-additional-information-label-id"]`),u=Array.from(d.options).find((e=>e.label.toLowerCase()===i.toLowerCase()));void 0===u?console.warn(`[TT Userscript] Could not find label ${i}`):u.selected=!0,c.querySelector(`input[name="normal-${e}-task-additional-information-custom-label"]`).value=a;const p=c.querySelector(`select[name="normal-${e}-task-additional-information-type"]`),m=Array.from(p.options).find((e=>e.label.toLowerCase()===l.toLowerCase()));if(void 0===m?console.warn(`[TT Userscript] Could not find type ${l}`):m.selected=!0,n.length>3){const e="true"===n[3].toLowerCase();c.querySelector('input[type="checkbox"]').checked=e}}return!0})(t,r.value)&&t.close()}))})),t.style="cursor: pointer; user-select: none;"):console.error("[TT Userscript] Add info label not found")}for(const o of["above","below"])for(const t of document.querySelectorAll(`#normal-${o}-table-body tr.row-id`))e(o,t);document.querySelector('button[data-action="add"][data-target="#normal-above-table"]').addEventListener("click",(o=>{o.stopPropagation(),addRow("#normal-above-table"),e("above",Array.from(document.querySelectorAll("#normal-above-table-body tr.row-id")).at(-1))})),document.querySelector('button[data-action="add"][data-target="#normal-below-table"]').addEventListener("click",(o=>{o.stopPropagation(),addRow("#normal-below-table"),e("below",Array.from(document.querySelectorAll("#normal-below-table-body tr.row-id")).at(-1))})),console.log("[TT Userscript] Critical path module loaded")}},293:e=>{e.exports=function(e="admin"){new MutationObserver((o=>{for(const t of o)if("childList"===t.type)for(const o of t.addedNodes){const t=o.querySelector("a").href.match(/\/([0-9]+)\//)[1],n=o.children[1];n.addEventListener("click",(()=>{window.open(`https://${e}.tarmactechnologies.com/users/customuser/${t}`)})),n.style="cursor: pointer; user-select: none;"}})).observe(document.querySelector("#users-list tbody"),{childList:!0,subtree:!0}),console.log("[TT Userscript] Users module loaded")}}},o={};function t(n){var r=o[n];if(void 0!==r)return r.exports;var s=o[n]={exports:{}};return e[n](s,s.exports,t),s.exports}(()=>{const e=t(109),o=t(581),n=t(614),r=t(293);!function(){"use strict";const t=window.location.hostname,s=window.location.pathname;/^(?:dev-)?backoffice.tarmactechnologies.com$/.test(t)&&(/^\/(?:specific_)?critical_path\/(?:[0-9]+\/)?(?:edit|add|new)/.test(s)&&n(),/\/users/i.test(s)&&r(/^dev-backoffice/.test(t)?"dev-admin":"admin")),/^(?:dev-)?admin.tarmactechnologies.com$/.test(t)&&/^\/users\/customuser\/[0-9]+\/change/.test(s)&&e(),/(?:dev-)?agoa.tarmactechnologies.com/.test(t)&&/^\/(?:agoa)?$/.test(s)&&o()}()})()})();